<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Audio/Video Transmitter</title> 
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200&icon_names=play_arrow" />
    <style>
/* Reset and general styles */
* {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
    font-family: 'Arial', sans-serif;
}

body {
    display: flex;
    flex-direction: column;
    justify-content: space-between;
    min-height: 100vh;
    background: linear-gradient(135deg, #ff5500, #0091ff);
    color: #fff;
    padding: 20px;
    transition: 1s ease-in-out;
}

/* Dynamic gradient effect */
body:hover {
    transition: 1s ease-in-out;

    background: linear-gradient(135deg, #ff884c, #72c1ff);
}

/* Header styles */
header {
    display: flex;
    flex-direction: column;
    align-items: center;
    margin-bottom: 20px;
}

#mediaLink {
    width: 100%;
    max-width: 400px;
    padding: 15px;
    border: none;
    border-radius: 30px;
    background: rgba(255, 255, 255, 0.2); /* Light translucent background */
    color: #fff;
    font-size: 16px;
    margin-bottom: 10px;
    transition: background 0.3s;
}

#mediaLink:focus {
    background: rgba(255, 255, 255, 0.4); /* Lighter on focus */
}

/* Button styles */
#sendLink {
    padding: 12px 24px;
    border: none;
    border-radius: 30px;
    background: #007bff;
    color: #fff;
    font-size: 16px;
    cursor: pointer;
    transition: background 0.3s, transform 0.1s;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.5);
}

#sendLink:hover {
    background: #0056b3;
    transform: scale(1.05);
}

/* Player styles */
#player {
    display: flex;
    justify-content: center;
    align-items: center;
    margin-bottom: 20px;
    border: 2px solid #4d4d4d;
    border-radius: 15px;
    overflow: hidden;
    background: rgba(255, 255, 255, 0.1); /* Light translucent background */
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
}

/* Footer styles */
footer {
    display: flex;
    flex-direction: column;
    align-items: center;
}

/* Control button styles */
#controls {
    display: flex; /* Horizontal alignment */
    flex-direction: row; 
    gap: 15px;
    margin-top: 15px;
}

.bt {
    padding: 10px 20px;
    border: none;
    border-radius: 50px;
    background: #6c757d;
    color: #fff;
    font-size: 16px;
    cursor: pointer;
    transition: background 0.3s, transform 0.1s;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.5);
}

.bt:hover {
    background: #5a6268;
    transform: scale(1.05);
}

/* Responsive styles */
@media (max-width: 600px) {
    header {
        flex-direction: column;
        align-items: center;
    }

    #mediaLink {
        flex: 1;
        margin-bottom: 10px;
    }

    #sendLink {
        flex-shrink: 0;
    }

    footer {
        flex-direction: row;
        justify-content: center;
    }

    #controls {
        flex-direction: row; /* Ensure horizontal layout on smaller devices */
        gap: 15px;
    }

    .bt {
        width: auto; /* Ensure buttons fit their content */
    }
}

/* Styles for smart watches */
@media (max-width: 300px) {
    body {
        padding: 10px;
    }

    #mediaLink {
        font-size: 14px;
    }

    #sendLink, .bt {
        padding: 8px 12px;
        font-size: 14px;
    }

    #player {
        height: 150px;
    }
}

    </style>
</head>
<body>

<header>
    <input type="text" id="mediaLink" placeholder="Enter audio/video link">
    <button id="sendLink">PLAY</button>
</header>

<div id="player"></div>

<footer>
    <div id="controls" style="display: none;">
        <button id="playBtn" class="bt">‚ñ∂Ô∏é</button>
        <button id="pauseBtn" class="bt">||</button>
        <button id="removeBtn" class="bt">üóëÔ∏è</button>
    </div>
</footer>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
    import { getDatabase, ref, set, remove, get, onValue } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-database.js";

    const firebaseConfig = {
        apiKey: "AIzaSyBd1hHYd-GmINKv0l0qwi_10udbiLsTeX0",
        authDomain: "quizzz-998c0.firebaseapp.com",
        databaseURL: "https://quizzz-998c0-default-rtdb.firebaseio.com",
        projectId: "quizzz-998c0",
        storageBucket: "quizzz-998c0.appspot.com",
        messagingSenderId: "320059830331",
        appId: "1:320059830331:web:221f1eebb6e363cc78ac1e"
    };

    const app = initializeApp(firebaseConfig);
    const database = getDatabase(app);

    let currentMediaLink = '';
    let player;
    let playerDiv;

    function fetchExistingMediaLink() {
        const mediaLinkRef = ref(database, 'mediaLink/link');
        get(mediaLinkRef).then((snapshot) => {
            if (snapshot.exists()) {
                currentMediaLink = snapshot.val();
                setupMediaPlayer(currentMediaLink);
                document.getElementById('controls').style.display = 'flex';
                playMedia();  // Ensure autoplay for existing link
            } else {
                console.log('No media link found in database');
            }
        }).catch((error) => {
            console.error('Error fetching media link:', error);
        });
    }

    const mediaStateRef = ref(database, 'mediaState');
    onValue(mediaStateRef, (snapshot) => {
        if (snapshot.exists()) {
            const state = snapshot.val();
            if (state.action === 'play') {
                playMedia();
            } else if (state.action === 'pause') {
                pauseMedia();
            }
        }
    });

    document.getElementById('sendLink').addEventListener('click', () => {
        const mediaLink = document.getElementById('mediaLink').value;
        if (isValidLink(mediaLink)) {
            currentMediaLink = mediaLink;
            set(ref(database, 'mediaLink'), { link: mediaLink });
            setupMediaPlayer(mediaLink);
            document.getElementById('controls').style.display = 'flex';
            playMedia(); // Autoplay after setting up
        } else {
            alert('Please enter a valid media link');
        }
    });

    function isValidLink(link) {
        const youtubeRegex = /(?:youtube\.com\/(?:[^\/\n\s]+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=)|youtu\.be\/)([a-zA-Z0-9_-]{11})/;
        return youtubeRegex.test(link);
    }

    function setupMediaPlayer(mediaLink) {
        playerDiv = document.getElementById('player');
        playerDiv.innerHTML = '';

        if (mediaLink.includes('youtube') || mediaLink.includes('youtu.be')) {
            let videoId = extractYouTubeID(mediaLink);
            if (videoId) {
                playerDiv.innerHTML = `<iframe id="ytplayer" width="100%" height="350px" src="https://www.youtube.com/embed/${videoId}?enablejsapi=1&autoplay=1" frameborder="0" allowfullscreen></iframe>`;
                initYouTubeAPI();
            }
        } else if (mediaLink.includes('.mp4') || mediaLink.includes('.webm')) {
            player = document.createElement('video');
            player.src = mediaLink;
            player.controls = true;
            player.autoplay = true;  // Ensure autoplay for local videos
            playerDiv.appendChild(player);
        }
    }

    function extractYouTubeID(url) {
        const youtubeRegex = /(?:youtube\.com\/(?:[^\/\n\s]+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=)|youtu\.be\/)([a-zA-Z0-9_-]{11})/;
        const match = url.match(youtubeRegex);
        return match && match[1] ? match[1] : null;
    }

    function initYouTubeAPI() {
        window.onYouTubeIframeAPIReady = function () {
            player = new YT.Player('ytplayer', {
                events: {
                    'onReady': onPlayerReady
                }
            });
        };

        const tag = document.createElement('script');
        tag.src = "https://www.youtube.com/iframe_api";
        document.body.appendChild(tag);
    }

    function onPlayerReady(event) {
        // Start autoplay muted
        player.mute();
        player.playVideo();
    
        // Unmute after a short delay
        setTimeout(() => {
            player.unMute();
        }, 300); // Adjust time as needed
    
        document.getElementById('playBtn').addEventListener('click', () => {
            set(ref(database, 'mediaState'), { action: 'play' });
            player.playVideo();
        });
    
        document.getElementById('pauseBtn').addEventListener('click', () => {
            set(ref(database, 'mediaState'), { action: 'pause' });
            player.pauseVideo();
        });
    
        document.getElementById('removeBtn').addEventListener('click', () => {
            set(ref(database, 'mediaLink'), { link: null });
            playerDiv.innerHTML = '';
            document.getElementById('controls').style.display = 'none';
            remove(ref(database, 'mediaState'));
        });
    }
    

    function pauseMedia() {
        if (player && typeof player.pauseVideo === 'function') {
            player.pauseVideo(); // Pause YouTube video
        } else if (player && typeof player.pause === 'function') {
            player.pause(); // Pause video element (e.g., MP4/WebM)
        }
    }

    window.onload = fetchExistingMediaLink;
</script>

</body>
</html>
